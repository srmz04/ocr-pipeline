<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>Captura RÃ¡pida - VacunaciÃ³n</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- Header -->
    <header class="header">
        <h1 class="header-title">ğŸ“· Captura</h1>
        <div class="header-actions">
            <button id="historyBtn" class="icon-btn" title="Historial">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <button id="helpBtn" class="icon-btn" title="Ayuda">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- Camera View -->
    <main class="camera-container">
        <!-- Camera Section -->
        <div id="cameraSection" class="hidden flex-1 flex flex-col relative bg-black">
            <!-- Camera Feed -->
            <div class="camera-container relative w-full flex-1 bg-black overflow-hidden flex justify-center items-center">
                <video id="camera" autoplay playsinline class="w-full h-full object-contain"></video>
                <div class="guide-frame"></div>
                <!-- Zoom Slider Overlay -->
                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 w-3/4 z-20 flex flex-col items-center">
                    <label class="text-white text-xs mb-1 font-bold drop-shadow-md">ğŸ” Zoom Digital</label>
                    <input type="range" id="zoomSlider" min="1" max="3" step="0.1" value="1" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>

            <!-- Controls -->
            <div class="p-4 bg-gray-900 grid grid-cols-2 gap-4">
                <button id="captureBtn" class="col-span-1 bg-white hover:bg-gray-100 text-gray-900 font-bold py-4 px-6 rounded-xl shadow-lg transform active:scale-95 transition-all flex flex-col items-center justify-center">
                    <span class="text-3xl mb-1">ğŸ“¸</span>
                    <span class="text-sm">Capturar</span>
                </button>

                <!-- Native Camera Fallback -->
                <button id="nativeCameraBtn" class="col-span-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transform active:scale-95 transition-all flex flex-col items-center justify-center">
                    <span class="text-3xl mb-1">ğŸ“±</span>
                    <span class="text-sm">CÃ¡mara Nativa</span>
                </button>
                <input type="file" id="nativeCameraInput" accept="image/*" capture="environment" hidden>
            </div>
        </div>
        <canvas id="overlay"></canvas>

        <!-- Status Indicator -->
        <div id="status" class="status status-ready">
            ğŸŸ¢ Listo para capturar
        </div>

        <!-- Guide Frame -->
        <div id="guideFrame" class="guide-frame">
            <div class="corner corner-tl"></div>
            <div class="corner corner-tr"></div>
            <div class="corner corner-bl"></div>
            <div class="corner corner-br"></div>
        </div>
    </main>

    <!-- Split Selectors Container -->
    <div class="split-container">
        <!-- Producto Selector (Left) -->
        <section class="selector half-width">
            <label class="selector-label">PRODUCTO</label>
            <div class="chip-list" id="productoSelector">
                <button class="chip" data-producto="VITAMINAS ACD">VITAMINAS ACD</button>
                <button class="chip" data-producto="BCG">BCG</button>
                <button class="chip" data-producto="Hepatitis B">Hepatitis B</button>
                <button class="chip" data-producto="Hexavalente">Hexavalente</button>
                <button class="chip" data-producto="Rotavirus">Rotavirus</button>
                <button class="chip" data-producto="NeumocÃ³cica Conjugada">NeumocÃ³cica</button>
                <button class="chip" data-producto="Influenza">Influenza</button>
                <button class="chip" data-producto="SRP (Triple Viral)">SRP</button>
                <button class="chip" data-producto="DPT">DPT</button>
                <button class="chip" data-producto="VPH">VPH</button>
                <button class="chip" data-producto="COVID">COVID</button>
                <button class="chip" data-producto="SR">SR</button>
                <button class="chip" data-producto="OTRA">OTRA...</button>
            </div>
            <!-- Custom Product Input (Hidden by default) -->
            <input type="text" id="customProductoInput" class="custom-input hidden" placeholder="Escribe el nombre...">
        </section>

        <!-- Dosis Selector (Right) -->
        <section class="selector half-width">
            <label class="selector-label">DOSIS</label>
            <div class="chip-list" id="dosisSelector">
                <button class="chip" data-dosis="1Âª">1Âª</button>
                <button class="chip" data-dosis="2Âª">2Âª</button>
                <button class="chip" data-dosis="3Âª">3Âª</button>
                <button class="chip" data-dosis="Refuerzo">Refuerzo</button>
                <button class="chip" data-dosis="Ãšnica">Ãšnica</button>
            </div>
        </section>
    </div>

    <!-- Add to Queue Button -->
    <button id="addToQueueBtn" class="add-queue-button" disabled>
        + AGREGAR A LISTA
    </button>

    <!-- Product Queue Display -->
    <div id="queueContainer" class="queue-container hidden">
        <label class="queue-label">ğŸ“‹ Productos a registrar:</label>
        <div id="queueList" class="queue-list">
            <!-- Queue items will be added here dynamically -->
        </div>
        <button id="clearQueueBtn" class="clear-queue-button">ğŸ—‘ï¸ Limpiar</button>
    </div>

    <!-- Capture Button -->
    <button id="captureBtn" class="capture-button" disabled>
        <span class="capture-icon">â—</span>
        <span class="capture-text">CAPTURAR</span>
    </button>

    <!-- Offline Indicator Bar (Hidden when no pending items) -->
    <div id="offlineBar" class="offline-bar hidden">
        <span class="offline-status">
            <span id="offlineIcon">ğŸ“´</span>
            <span id="offlinePendingText">0 pendientes</span>
        </span>
        <div class="offline-actions">
            <button id="syncBtn" class="offline-btn sync-btn" title="Sincronizar">
                ğŸ”„ Sincronizar
            </button>
            <button id="downloadZipBtn" class="offline-btn download-btn" title="Descargar ZIP">
                ğŸ“¦ Descargar ZIP
            </button>
        </div>
    </div>

    <!-- Stats Footer -->
    <footer class="footer">
        <span>Hoy: <strong id="countToday">0</strong></span>
        <span>Ãšltima: <strong id="lastTime">--:--</strong></span>
    </footer>

    <!-- History Sidebar (Hidden by default) -->
    <aside id="historySidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <h2>Ãšltimas capturas</h2>
            <button id="closeSidebar" class="icon-btn">âœ•</button>
        </div>
        <div id="historyList" class="history-list">
            <!-- Populated dynamically -->
        </div>
    </aside>

    <!-- Help Modal (Hidden by default) -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“– GuÃ­a RÃ¡pida</h2>
                <button id="closeHelp" class="icon-btn">âœ•</button>
            </div>
            <div class="modal-body">
                <h3>Pasos:</h3>
                <ol>
                    <li>Selecciona el <strong>biolÃ³gico</strong> aplicado</li>
                    <li>Selecciona la <strong>dosis</strong></li>
                    <li>Encuadra la <strong>credencial o cartilla</strong></li>
                    <li>Espera seÃ±al verde ğŸŸ¢</li>
                    <li>Presiona <strong>CAPTURAR</strong></li>
                </ol>

                <h3>Indicadores:</h3>
                <ul>
                    <li>ğŸŸ¢ <strong>Verde</strong>: Listo para capturar</li>
                    <li>ğŸŸ¡ <strong>Amarillo</strong>: Mejora iluminaciÃ³n/enfoque</li>
                    <li>ğŸ”´ <strong>Rojo</strong>: No se puede capturar</li>
                </ul>

                <h3>Tips:</h3>
                <ul>
                    <li>Usa buena iluminaciÃ³n natural</li>
                    <li>MantÃ©n el documento plano</li>
                    <li>Evita reflejos y sombras</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Subiendo...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast hidden"></div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="google-api.js"></script>
    <script src="camera.js"></script>
    <script src="validator.js"></script>
    <script src="uploader.js"></script>
    <script src="offline-manager.js"></script>
    <script src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('[PWA] Service Worker registered:', reg.scope))
                    .catch(err => console.error('[PWA] SW registration failed:', err));
            });
        }
    </script>

</body>

</html>